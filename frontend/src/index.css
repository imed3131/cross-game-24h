@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom styles */
@layer base {
  html {
    scroll-behavior: smooth;
  }
  
  body {
    @apply font-sans text-gray-900 bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen;
    font-feature-settings: "kern" 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* RTL support */
  .rtl {
    direction: rtl;
  }
  
  .rtl input {
    text-align: right;
  }

  /* Force LTR for the crossword player grid when necessary */
  .player-grid-force-ltr {
    direction: ltr !important;
    width: 100%;            /* fill parent but do not overflow */
    max-width: min(900px, 100%);    margin-left: auto;
    margin-right: auto; /* center the board block inside its container */  }
  .player-grid-force-ltr input {
    direction: ltr !important;
    text-align: center !important;
  }
  .maxwidth-full{
    max-width: 100%;
    transform: none;
  }
  .grid-scroll-container {
  overflow-x: hidden; /* no horizontal scroll; grid will shrink to fit */
  overflow-y: visible;
  width: 100%;
}
}

@layer components {
  /* Button components */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all duration-200 ease-in-out;
  }
  
  .btn-primary {
    @apply btn bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white shadow-lg hover:shadow-xl focus:ring-primary-500 transform hover:scale-105;
  }
  
  .btn-secondary {
    @apply btn bg-gradient-to-r from-secondary-600 to-secondary-700 hover:from-secondary-700 hover:to-secondary-800 text-white shadow-lg hover:shadow-xl focus:ring-secondary-500 transform hover:scale-105;
  }
  
  .btn-success {
    @apply btn bg-gradient-to-r from-success-600 to-success-700 hover:from-success-700 hover:to-success-800 text-white shadow-lg hover:shadow-xl focus:ring-success-500 transform hover:scale-105;
  }
  
  .btn-danger {
    @apply btn bg-gradient-to-r from-error-600 to-error-700 hover:from-error-700 hover:to-error-800 text-white shadow-lg hover:shadow-xl focus:ring-error-500 transform hover:scale-105;
  }
  
  .btn-outline {
    @apply btn border-2 border-primary-600 text-primary-600 hover:bg-primary-600 hover:text-white focus:ring-primary-500;
  }
  
  /* Card components */
  .card {
    @apply bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out border border-gray-100 backdrop-blur-sm;
  }
  
  .card-hover {
    @apply card hover:transform hover:scale-105 hover:bg-gradient-to-br hover:from-white hover:to-blue-50;
  }
  
  /* Input components */
  .input {
    @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200 bg-white shadow-sm;
  }
  
  .input-error {
    @apply input border-error-500 focus:ring-error-500;
  }
  
  /* Unified board layout */
  .board-grid { align-items: center; justify-items: stretch; width: 100%; --cell-max: clamp(44px, 3.6vw, 64px); }
  .board-grid .clue-wrapper { display: block; }
  .board-grid .clue-anchor { width: 100% !important; height: auto !important; aspect-ratio: 1 / 1; padding: 0.2rem !important; box-sizing: border-box; display:flex; align-items:center; justify-content:center; }

  /* Crossword grid styles - responsive cells */
  .crossword-cell {
    /* fully flexible: width follows the grid track, no enforced minimum */
    width: 100%;
    aspect-ratio: 1 / 1; /* square cells */
    border: 1px solid rgba(148,163,184,1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    background: #ffffff;
    transition: all .15s;
    font-size: clamp(12px, 1.2vw, 16px);
    box-sizing: border-box;
    box-sizing: border-box;
    flex: none;
  }

  /* Player-scoped header and input tweaks */
  /* Ensure header anchors are strictly square and their content scales */
  .board-grid .clue-anchor {
    aspect-ratio: 1 / 1; /* force square */
    overflow: hidden;
    flex-shrink: 0;
    padding: 0.18rem !important; /* slightly reduce default padding for tight grids */
  }
  .board-grid .clue-anchor .col-number,
  .board-grid .clue-anchor .row-number {
    font-size: clamp(10px, 1.4vw, 14px);
    font-weight: 700;
    line-height: 1;
    display: inline-block;
    text-align: center;
  }

  /* Use a class-controlled input font-size so we can adjust on small screens specifically for the player grid */
  .player-grid-force-ltr .crossword-cell input,
  .player-grid-force-ltr .crossword-input {
    font-size: clamp(12px, 2.4vw, 18px);
    line-height: 1;
    letter-spacing: 0.02em;
  }

  /* Mobile-specific tightening to ensure letters fit into very small cells */
  @media (max-width: 480px) {
    .player-grid-force-ltr .crossword-cell input,
    .player-grid-force-ltr .crossword-input {
      font-size: clamp(10px, 4.6vw, 12px);
    }
    .board-grid .clue-anchor .col-number,
    .board-grid .clue-anchor .row-number {
      font-size: 11px;
    }
    /* allow smaller max cell size on tiny screens so the whole grid fits */
    .board-grid { --cell-max: clamp(36px, 8vw, 48px); }
  }
  
  .crossword-cell-black {
    background: #0f172a;
    border-color: #0f172a;
  }

  /* Ensure header anchors and blank corner follow column width and stay square */
  .player-grid-force-ltr .clue-anchor {
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1 / 1;
    padding: 0.2rem !important;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .blank-corner {
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1 / 1;
  }  
  .crossword-cell-active {
    @apply bg-blue-100 border-blue-500 ring-2 ring-blue-300 ring-opacity-50;
  }
  
  .crossword-cell-highlighted {
    @apply bg-yellow-100 border-yellow-400;
  }
  
  .crossword-cell-number {
    @apply absolute top-0 left-0 text-xs leading-none p-0.5 text-gray-600 font-medium;
  }
  
  /* Floating clue tooltip styles (explicit rules for consistent rendering) */
  .floating-clue {
    position: absolute;
    background: #ffffff;
    color: #0f172a; /* gray-900 */
    padding: 10px 12px;
    border-radius: 10px;
    box-shadow: 0 12px 36px rgba(2,6,23,0.14), 0 3px 8px rgba(2,6,23,0.06);
    z-index: 9999;
    border: 1px solid rgba(15,23,42,0.06);
  max-width: 300px;
  width: auto; /* allow content to wrap within max-width */
  min-width: 120px;
    word-wrap: break-word;
  transition: opacity 140ms ease, transform 160ms cubic-bezier(.2,.9,.3,1);
  opacity: 0;
    font-size: 14px;

    /* hide scrollbars visually while keeping wheel/touch scrolling functional */
    -ms-overflow-style: none; /* IE/Edge */
    scrollbar-width: none; /* Firefox */
  }

  /* WebKit scrollbar removal */
  .floating-clue::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
  }

  /* show state is controlled inline via render; add a visible class when mounted */
  .floating-clue[data-visible="true"] {
    opacity: 1;
  }

  /* Mobile-specific clue styles */
  @media (max-width: 768px) {
    .floating-clue {
      padding: 14px 16px;
      max-width: 88vw;
      min-width: 160px;
      font-size: 16px; /* avoids iOS zoom */
    }
  }

  /* Arrow tails: use a small rotated square (diamond) to create a consistent tail shape */
  .floating-clue::before {
    content: '';
    position: absolute;
    --arrow-size: 12px;
    width: var(--arrow-size);
    height: var(--arrow-size);
    background: #ffffff;
  transform: rotate(45deg);
    box-shadow: 0 6px 16px rgba(2,6,23,0.08);
    pointer-events: none;
    border-radius: 2px;
    opacity: 1;
  }

  .floating-clue.arrow-down::before { /* bubble above target */
    left: calc(var(--arrow-left, 50%) - (var(--arrow-size) / 2));
    bottom: calc(-1 * (var(--arrow-size) / 2));
    transform: rotate(45deg);
  }

  .floating-clue.arrow-up::before { /* bubble below target */
    left: calc(var(--arrow-left, 50%) - (var(--arrow-size) / 2));
    top: calc(-1 * (var(--arrow-size) / 2));
    transform: rotate(45deg);
  }

  .floating-clue.arrow-right::before { /* bubble to left of target */
    right: calc(-1 * (var(--arrow-size) / 2));
    top: calc(var(--arrow-top, 50%) - (var(--arrow-size) / 2));
    transform: rotate(45deg);
  }

  .floating-clue.arrow-left::before { /* bubble to right of target */
    left: calc(-1 * (var(--arrow-size) / 2));
    top: calc(var(--arrow-top, 50%) - (var(--arrow-size) / 2));
    transform: rotate(45deg);
  }

  /* Clue inner elements */
  .floating-clue .clue-badge {
    display: inline-block;
    background: #eef2ff;
    color: #1e40af;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
  }

  .floating-clue .clue-body {
    margin-top: 6px;
    white-space: pre-wrap; /* preserve newlines */
    word-break: break-word;
    line-height: 1.3;
    font-size: 15px;
  }

  /* Larger admin clues when editing/creating puzzles (also applies to portal tooltips via body class) */
  .create-crossword .floating-clue .clue-body,
  body.create-crossword-mode .floating-clue .clue-body {
    font-size: 34px !important; /* much bigger for clear visibility */
    line-height: 1.55 !important;
    font-weight: 700 !important;
  }

  /* For admin hover-only floating clues (not the small click-persistent ones), use a larger size for easier reading */
  body.create-crossword-mode .floating-clue:not(.small-clue) .clue-body {
    font-size: 20px !important;
    line-height: 1.5 !important;
    font-weight: 600 !important;
  }

  /* Small persistent clues used by admin on CLICK (compact, readable at 16px) */
  .small-clue {
    position: absolute;
    background: #ffffff;
    color: #0f172a;
    padding: 8px 10px;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(2,6,23,0.10);
    border: 1px solid rgba(15,23,42,0.06);
    max-width: 380px;
    font-size: 16px !important;
    z-index: 9999;
    transition: opacity 140ms ease, transform 160ms cubic-bezier(.2,.9,.3,1);
    opacity: 0;
  }
  .small-clue[data-visible="true"] { opacity: 1; }
  .small-clue .clue-body { font-size: 20px !important; line-height: 1.4; }

  /* In admin mode, prefer larger cells (helps visibility for creators) */
  body.create-crossword-mode .board-grid { --cell-max: clamp(56px, 4vw, 80px); }
  .create-crossword .floating-clue .clue-badge,
  body.create-crossword-mode .floating-clue .clue-badge {
    font-size: 20px !important;
    padding: 12px 16px !important;
  }
  /* Tooltip container larger on desktop so the much larger text fits comfortably */
  @media (min-width: 768px) {
    .create-crossword .floating-clue,
    body.create-crossword-mode .floating-clue {
      max-width: 640px !important;
      padding: 18px 26px !important;
    }
  }
  /* Slightly increase on small screens too so it remains readable */
  @media (max-width: 767px) {
    .create-crossword .floating-clue,
    body.create-crossword-mode .floating-clue {
      font-size: 22px; /* ensures readability on mobile */
    }
  }

  .floating-clue .clue-close {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 28px;
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: #475569;
    cursor: pointer;
  }

  /* Mobile mode: wider centered panel, no diamond tail */
  .floating-clue.mobile-mode {
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: min(92vw, 520px) !important;
    max-width: 92vw !important;
    bottom: 110px; /* above controls */
    top: auto !important;
    box-shadow: 0 18px 46px rgba(2,6,23,0.18);
    border-radius: 12px;
  }

  .floating-clue.no-arrow::before { display: none; }

  /* entrance tweak */
  .floating-clue[data-visible="true"] {
    transform: translateY(0);
    opacity: 1;
  }
  .floating-clue:not([data-visible]) {
    transform: translateY(-6px);
  }

  /* increase stacking so it stays above controls */
  .floating-clue {
    z-index: 9999;
  }

  /* RTL support when the clue itself is RTL */
  .floating-clue.rtl {
    direction: rtl;
    text-align: right;
  }
  
  /* Animation helpers */
  .animate-shake {
    animation: shake 0.5s ease-in-out;
  }
  
  .animate-celebration {
    animation: bounceIn 0.6s ease-out;
  }
  
  .animate-float {
    animation: float 3s ease-in-out infinite;
  }
  
  /* Glass morphism effect */
  .glass {
    backdrop-filter: blur(8px);
    background-color: rgba(255,255,255,0.8);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 24px rgba(15,23,42,0.08);
  }
  
  .glass-dark {
    backdrop-filter: blur(8px);
    background-color: rgba(17,24,39,0.8);
    border: 1px solid rgba(55,65,81,0.12);
    box-shadow: 0 8px 24px rgba(2,6,23,0.12);
  }
}

@layer utilities {
  /* Custom scrollbar */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
  }
  
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }
  
  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
  
  /* Text gradients */
  .text-gradient {
    background: linear-gradient(90deg,#2563eb 0%,#7c3aed 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }
  
  .text-gradient-success {
    background: linear-gradient(90deg,#16a34a 0%,#059669 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }
  
  /* Custom shadows */
  .shadow-glow {
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
  }
  
  .shadow-glow-success {
    box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
  }
  
  .shadow-glow-error {
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
  }
  
  /* Arabic font support */
  .font-arabic {
    font-family: 'Amiri', 'Times New Roman', serif;
    font-weight: bold;
    font-size: 1.1em;
    line-height: 1.2;
  }
}
